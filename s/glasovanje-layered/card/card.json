{"_id":"57279e0dc33c714e03229d7a","name":"Glasovanje layered","group":"s","method":"glasovanje-layered","dataUrl":"https://analize.parlameter.si/v1/s/getMotionGraph","ejs":"<style>.card-glasovanje-layered .label-party,.card-glasovanje-layered .pointer-party{opacity:0}.card-glasovanje-layered text{font:12px sans-serif;text-anchor:middle;color:#505050;font-weight:300}.card-glasovanje-layered path.pointer{stroke:#505050}.card-glasovanje-layered .card-header{height:auto}.card-glasovanje-layered .slab{font-family:'Roboto Slab',serif;font-size:16px}.card-glasovanje-layered a.document{display:inline-block;border-radius:50%;height:35px;width:35px;background-color:#00628c;line-height:35px;text-align:center;color:#fff;margin-left:10px}.card-glasovanje-layered a.document:hover{text-decoration:none;background-color:#009cdd}.card-glasovanje-layered .greybox{background-color:#f7f7f7;padding:15px;margin-top:15px;margin-bottom:15px;overflow:hidden}.card-glasovanje-layered .legend-container{display:block;float:left;height:48px}.card-glasovanje-layered .legend-container .option{display:inline-block;margin-right:20px}.card-glasovanje-layered .legend-container .option .option-marker{display:inline-block;background-color:#000;width:10px;height:40px}.card-glasovanje-layered .legend-container .option .option-marker-za{background-color:#00628C}.card-glasovanje-layered .legend-container .option .option-marker-proti{background-color:#009CDD}.card-glasovanje-layered .legend-container .option .option-marker-vzdrzani{background-color:#003B54}.card-glasovanje-layered .legend-container .option .option-marker-niso{background-color:#99E1FF}.card-glasovanje-layered .legend-container .option .option-text{display:inline-block}.card-glasovanje-layered .legend-container .option .option-number{font-size:30px;font-weight:400;color:#515151;line-height:30px;padding:0;margin:0}.card-glasovanje-layered .legend-container .option .option-option{font-size:16px;color:#515151;line-height:16px}.card-glasovanje-layered .right-container{position:relative;float:left;margin-left:30px}.card-glasovanje-layered .status-container{display:block;float:left;height:48px;font-size:16px;margin-right:20px}.card-glasovanje-layered .status-container .status{display:inline-block;line-height:48px;font-weight:700}.card-glasovanje-layered .status-container i{font-size:14px;margin-left:5px}.card-glasovanje-layered .status-container .glyphicon-remove{color:#FF5E41}.card-glasovanje-layered .status-container .glyphicon-ok{color:#7AE7BF}.card-glasovanje-layered .required-majority{display:block;float:left;line-height:48px}.card-glasovanje-layered .member{overflow:hidden}.card-glasovanje-layered .member p.name,.card-glasovanje-layered .member p.party{margin-top:30px}.card-glasovanje-layered .member p.party{float:right}.card-glasovanje-layered .member:last-of-type{border-bottom:none}.card-glasovanje-layered .arc path{transition:all 1s ease-in;cursor:pointer}.card-glasovanje-layered .label,.card-glasovanje-layered .pointer{transition:opacity .3 ease-out}</style><script>var data = <%- JSON.stringify(data); %></script><div class=\"card-container card-halfling card-glasovanje-layered\"><div class=\"card-header\"><div class=\"card-header-border\"></div><h1>Glasovanje o Zakonu o ratifikaciji Sporazuma o pridružitvi med Evropsko unijo in Evropsko skupnostjo za atomsko energijo in njunimi državami članicami na eni strani ter Ukrajino na drugi strani</h1></div><div class=\"card-content\"><div class=\"row\"><div class=\"col-xs-12\"><span class=\"slab\">Dokumenti: </span><a href=\"https://parlameter.si\" target=\"_blank\" class=\"document\">pdf</a></div></div><div class=\"row\"><div class=\"col-xs-12\"><div class=\"greybox\"><div class=\"legend-container\"><div class=\"option za\"><div class=\"option-marker option-marker-za\"></div><div class=\"option-text\"><div class=\"option-number\"> <%= data.all.for.total_votes %> </div><div class=\"option-option\">ZA</div></div></div><div class=\"option proti\"><div class=\"option-marker option-marker-proti\"></div><div class=\"option-text\"><div class=\"option-number\"> <%= data.all.against.total_votes %> </div><div class=\"option-option\">PROTI</div></div></div><div class=\"option vzdrzani\"><div class=\"option-marker option-marker-vzdrzani\"></div><div class=\"option-text\"><div class=\"option-number\"> <%= data.all.not_present.total_votes %> </div><div class=\"option-option\">VZDRŽANI</div></div></div><div class=\"option niso\"><div class=\"option-marker option-marker-niso\"></div><div class=\"option-text\"><div class=\"option-number\"> <%= data.all.kvorum.total_votes %> </div><div class=\"option-option\">NISO</div></div></div></div><div class=\"right-container\"><div class=\"status-container\"><span class=\"slab\">Status predloga:</span><div class=\"status\"><span class=\"status-text\"><% if (data.result) { %> SPREJET <% } else { %> ZAVRNJEN <% } %></span><i class=\"status-icon glyphicon <% if (data.result) { %> glyphicon-ok <% } else { %> glyphicon-remove <% } %>\"></i></div></div><div class=\"required-majority\"><span class=\"slab\">Potrebna večina: <strong><%= data.required %></strong></span></div></div></div></div></div><div class=\"row\"><div class=\"col-xs-12\"><div class=\"layeredchart\"></div></div></div><div class=\"row\"><div class=\"col-xs-12\"> <% var second_level_data = []; for (option in data.all) { for (party in data.all[option]['breakdown']) { var newdict = data.all[option]['breakdown'][party]; newdict.option = option; second_level_data.push(newdict); } } %> <% for (group in second_level_data) { %> <div class=\"mpgroup hidden <%= second_level_data[group]['option']%> <%= second_level_data[group]['pg']['acronym'].replace(' ', '_') %>\"> <% for (mp in second_level_data[group]['mps']) { %> <div class=\"member\"><div class=\"metadata\"><div class=\"image\" style=\"background-image: url(https://cdn.parlameter.si/v1/parlassets/img/people/square/<%= second_level_data[group]['mps'][mp]['gov_id'] %>.png); background-size: cover\"></div><p class=\"name\"> <%= second_level_data[group]['mps'][mp]['name'] %> </p><p class=\"party\"> <%= second_level_data[group]['mps'][mp]['party']['acronym'] %> </p></div></div> <% } %> </div> <% } %> </div></div></div><div class=\"card-footer\"><div class=\"card-circle-button card-share\"></div><div class=\"card-circle-button card-embed\"></div><div class=\"card-circle-button card-info\">i</div></div></div><script>function groupBy(t,a){var e={};return t.forEach(function(t){var n=JSON.stringify(a(t));e[n]=e[n]||[],e[n].push(t)}),Object.keys(e).map(function(t){return e[t]})}function drawPie(t){var a=d3.svg.arc().outerRadius(2*radius-10),e=(d3.svg.arc().outerRadius(1.5*radius-50).innerRadius(1.5*radius-100),d3.layout.pie().sort(null).value(function(t){return t.mps.length})),n=e(t),r=svg.selectAll(\".arc\").data(n).enter().append(\"g\").classed(\"arc\",!0);r.append(\"path\").attr(\"d\",a).attr(\"class\",function(t){return t.data.option+\"-arc\"}).style(\"fill\",function(t){return color(t.data.option)}).style(\"stroke\",function(t){return color(t.data.option)}).style(\"stroke-width\",0).on(\"mouseover\",function(t){d3.selectAll(\".\"+t.data.option+\"-arc\").classed(\"hover\")||(d3.selectAll(\".label-option\").transition().duration(300).style(\"opacity\",0),d3.selectAll(\".pointer-option\").transition().duration(300).style(\"opacity\",0),d3.selectAll(\".\"+t.data.option+\"-label-party\").transition().duration(300).style(\"opacity\",1),d3.selectAll(\".\"+t.data.option+\"-pointer-party\").transition().duration(300).style(\"opacity\",1),d3.selectAll(\".\"+t.data.option+\"-arc\").classed(\"hover\",!0).transition().duration(300).attrTween(\"transform\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2,e=\"translate(\"+Math.cos(a)*(.05*radius)+\",\"+Math.sin(a)*(.05*radius)+\")\";return d3.interpolateString(\"translate(0, 0)\",e)}))}).on(\"mouseleave\",function(t){d3.selectAll(\".\"+t.data.option+\"-arc\").classed(\"active\")||(d3.selectAll(\".\"+t.data.option+\"-arc\").classed(\"hover\",!1).transition().duration(300).attrTween(\"transform\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2,e=\"translate(\"+Math.cos(a)*(.05*radius)+\",\"+Math.sin(a)*(.05*radius)+\")\";return d3.interpolateString(e,\"translate(0, 0)\")}),d3.selectAll(\".\"+t.data.option.replace(\" \",\"_\")+\"-label-party\").transition().duration(300).style(\"opacity\",0),d3.selectAll(\".\"+t.data.option.replace(\" \",\"_\")+\"-pointer-party\").transition().duration(300).style(\"opacity\",0),0===d3.selectAll(\".active\")[0].length&&(d3.selectAll(\".label-option\").transition().duration(300).style(\"opacity\",1),d3.selectAll(\".pointer-option\").transition().duration(300).style(\"opacity\",1)))}).on(\"click\",function(t){if(d3.event.stopPropagation(),0===d3.selectAll(\".active\")[0].length){d3.selectAll(\".\"+t.data.option+\"-arc\").classed(\"active\",!0),d3.selectAll(\".mpgroup\").classed(\"hidden\",!0);var a=d3.selectAll(\".\"+t.data.option);a.classed(\"hidden\",!1)}else if(d3.selectAll(\".\"+t.data.option+\"-arc\").classed(\"active\"))if(d3.select(this).classed(\"chosen\")){d3.select(this).classed(\"chosen\",!1).transition().duration(300).attrTween(\"transform\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2,e=\"translate(\"+Math.cos(a)*(.1*radius)+\",\"+Math.sin(a)*(.1*radius)+\")\",n=\"translate(\"+Math.cos(a)*(.05*radius)+\",\"+Math.sin(a)*(.05*radius)+\")\";return d3.interpolateString(e,n)}),d3.selectAll(\".mpgroup\").classed(\"hidden\",!0);var a=d3.selectAll(\".\"+t.data.option);a.classed(\"hidden\",!1)}else{d3.selectAll(\"path.chosen\").classed(\"chosen\",!1).transition().duration(300).attrTween(\"transform\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2,e=\"translate(\"+Math.cos(a)*(.1*radius)+\",\"+Math.sin(a)*(.1*radius)+\")\",n=\"translate(\"+Math.cos(a)*(.05*radius)+\",\"+Math.sin(a)*(.05*radius)+\")\";return d3.interpolateString(e,n)}),d3.select(this).classed(\"chosen\",!0).transition().duration(300).attrTween(\"transform\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2,e=\"translate(\"+Math.cos(a)*(.05*radius)+\",\"+Math.sin(a)*(.05*radius)+\")\",n=\"translate(\"+Math.cos(a)*(.1*radius)+\",\"+Math.sin(a)*(.1*radius)+\")\";return d3.interpolateString(e,n)}),d3.selectAll(\".mpgroup\").classed(\"hidden\",!0);var a=d3.select(\".\"+t.data.option+\".\"+t.data.pg.acronym.replace(\" \",\"_\"));a.classed(\"hidden\",!1)}else{console.log(\"inactive\"),d3.selectAll(\"path.chosen\").classed(\"chosen\",!1).transition().duration(300).attrTween(\"transform\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2,e=\"translate(\"+Math.cos(a)*(.1*radius)+\",\"+Math.sin(a)*(.1*radius)+\")\",n=\"translate(\"+Math.cos(a)*(.05*radius)+\",\"+Math.sin(a)*(.05*radius)+\")\";return d3.interpolateString(e,n)});var e=d3.select(\"path.active\").datum().data.option;d3.selectAll(\"path.active\").classed(\"active\",!1).classed(\"hover\",!1).transition().delay(300).duration(300).attrTween(\"transform\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2,e=\"translate(\"+Math.cos(a)*(.05*radius)+\",\"+Math.sin(a)*(.05*radius)+\")\";return d3.interpolateString(e,\"translate(0, 0)\")}),d3.selectAll(\".\"+e.replace(\" \",\"_\")+\"-label-party\").transition().duration(300).style(\"opacity\",0),d3.selectAll(\".\"+e.replace(\" \",\"_\")+\"-pointer-party\").transition().duration(300).style(\"opacity\",0),d3.selectAll(\".\"+t.data.option+\"-arc\").classed(\"active\",!0),d3.selectAll(\".mpgroup\").classed(\"hidden\",!0);var a=d3.selectAll(\".\"+t.data.option);a.classed(\"hidden\",!1)}})}function drawOptionLabels(t){function a(t){t.each(function(t){var a=d3.select(this),e=this.getBBox();t.sx=+a.attr(\"x\")-e.width/2-2,t.ox=+a.attr(\"x\")+e.width/2+2,t.sy=t.oy=+a.attr(\"y\")+5,t.endx=+a.attr(\"x\")+e.width}),svg.selectAll(\"path.pointer.pointer-option\").data(n).enter().append(\"path\").attr(\"class\",\"pointer\").classed(\"pointer-option\",!0).style(\"fill\",\"none\").attr(\"d\",function(t){var a=2.1;return t.cx>t.ox?\"M\"+t.sx+\",\"+t.sy+\"L\"+t.ox+\",\"+t.oy+\" \"+t.cx*a+\",\"+t.cy*a:t.endx>0&&Math.abs(t.cx)<10?\"M\"+t.sx+\",\"+t.sy+\"L\"+t.ox+\",\"+t.oy+\" \"+t.cx*a+\",\"+t.cy*a:\"M\"+t.ox+\",\"+t.oy+\"L\"+t.sx+\",\"+t.sy+\" \"+t.cx*a+\",\"+t.cy*a}).style(\"display\",function(t){return 0===+t.data.percentage?\"none\":\"block\"})}var e=d3.layout.pie().sort(null).value(function(t){return t.total_votes}),n=e(t),r=svg.selectAll(\"text.option-label\").data(n).enter().append(\"text\").attr(\"text-anchor\",\"middle\").attr(\"x\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2;return t.cx=Math.cos(a)*(2*radius-73),t.x=Math.cos(a)*(2*radius+25)}).attr(\"y\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2;return t.cy=Math.sin(a)*(2*radius-73),t.y=Math.sin(a)*(2*radius+25)}).attr(\"class\",function(t){return t.data.option+\"-label-option\"}).classed(\"label-option\",!0).classed(\"label\",!0).text(function(t){var a=\"\";switch(t.data.option){case\"kvorum\":a=\"VZDRŽANI\";break;case\"not_present\":a=\"NISO\";break;case\"for\":a=\"ZA\";break;case\"against\":a=\"PROTI\"}return a+\" | \"+t.data.total_votes}).each(function(t){var a=this.getBBox();t.sx=t.x-a.width/2-2,t.ox=t.x+a.width/2+2,t.sy=t.oy=t.y+5});a(r)}function drawPartyLabels(t){function e(t){again=!1,t.each(function(e,n){a=this,da=d3.select(a),y1=da.attr(\"y\"),x1=da.attr(\"x\"),t.each(function(t,e){b=this,a!=b&&(db=d3.select(b),y2=db.attr(\"y\"),x2=db.attr(\"x\"),deltaY=y1-y2,deltaX=x1-x2,Math.abs(deltaY)>d||Math.abs(deltaX)>c||(again=!0,sign=deltaY>0?1:-1,adjust=sign*o,da.attr(\"y\",+y1+adjust),db.attr(\"y\",+y2-adjust),sign=deltaX>0?1:-1,adjust=sign*o,da.attr(\"x\",+x1+adjust),db.attr(\"x\",+x2-adjust)))})}),again&&setTimeout(e(t),20)}function n(t){t.each(function(t){var a=d3.select(this),e=this.getBBox();t.sx=+a.attr(\"x\")-e.width/2-2,t.ox=+a.attr(\"x\")+e.width/2+2,t.sy=t.oy=+a.attr(\"y\")+5,t.endx=+a.attr(\"x\")+e.width}),svg.selectAll(\"path.pointer-party\").data(s).enter().append(\"path\").attr(\"class\",function(t){return t.data.option+\"-pointer-party\"}).classed(\"pointer\",!0).classed(\"pointer-party\",!0).style(\"fill\",\"none\").attr(\"d\",function(t){var a=2.2;return t.cx>t.ox-8?\"M\"+t.sx+\",\"+t.sy+\"L\"+t.ox+\",\"+t.oy+\" \"+t.cx*a+\",\"+t.cy*a:t.endx>0&&Math.abs(t.cx)<10?\"M\"+t.sx+\",\"+t.sy+\"L\"+t.ox+\",\"+t.oy+\" \"+t.cx*a+\",\"+t.cy*a:\"M\"+t.ox+\",\"+t.oy+\"L\"+t.sx+\",\"+t.sy+\" \"+t.cx*a+\",\"+t.cy*a}).style(\"display\",function(t){return 0===+t.data.percentage?\"none\":\"block\"})}var r=d3.layout.pie().sort(null).value(function(t){return t.mps.length}),s=r(t),l=svg.selectAll(\"text.label-party\").data(s).enter().append(\"text\").attr(\"text-anchor\",\"middle\").attr(\"x\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2;return t.cx=Math.cos(a)*(2*radius-73),t.x=Math.cos(a)*(2*radius+25)}).attr(\"y\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2;return t.cy=Math.sin(a)*(2*radius-73),t.y=Math.sin(a)*(2*radius+25)}).attr(\"class\",function(t){return t.data.option+\"-label-party\"}).classed(\"label-party\",!0).classed(\"label\",!0).text(function(t){return t.data.pg.acronym+\" | \"+t.data.mps.length}).each(function(t){var a=this.getBBox();t.sx=t.x-a.width/2-2,t.ox=t.x+a.width/2+2,t.sy=t.oy=t.y+5;var e=2.2;t.cx*e>t.sx&&t.cy*e<t.sy&&t.cx<0&&d3.select(this).attr(\"x\",function(t){return t.x-Math.abs(t.cx*e-t.sx)/3.5}),t.cx*e>t.sx&&t.cy<t.sy&&t.cx<t.ox-8&&d3.select(this).attr(\"x\",function(t){return t.x+Math.abs(t.cx*e-t.sx)})}),o=.5,d=20,c=40;groupedData=groupBy(second_level_data,function(t){return[t.option]});for(i in groupedData){var u=d3.selectAll(\".\"+groupedData[i][0].option+\"-label-party\");e(u)}n(l)}function moveSingleMP(){var t=d3.select(\".\"+d.data.option+\".\"+d.data.pg.acronym.replace(\" \",\"_\"));t.classed(\"hidden\",!t.classed(\"hidden\")),_this=d3.select(this),_this.classed(\"selected\")?_this.attr(\"transform\",function(t){return\"translate(0, 0)\"}).classed(\"selected\",!1):_this.attr(\"transform\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2;return\"translate(\"+Math.cos(a)*(.2*radius)+\",\"+Math.sin(a)*(.2*radius)+\")\"}).classed(\"selected\",!0)}var openOption=!1,margin={top:50,right:50,bottom:50,left:50},width=400-margin.left-margin.right,height=400-margin.top-margin.bottom,radius=Math.min(width,height)/4.5,color=d3.scale.ordinal().range([\"#009CDD\",\"#00628C\",\"#99E1FF\",\"#003B54\"]),svg=d3.select(\".layeredchart\").append(\"svg\").attr(\"viewBox\",\"0 0 400 400\").attr(\"preserveAspectRatio\",\"xMidYMid meet\").on(\"click\",function(){d3.selectAll(\".label-option\").transition().duration(300).style(\"opacity\",0),d3.selectAll(\".pointer-option\").transition().duration(300).style(\"opacity\",0),d3.selectAll(\".mpgroup\").classed(\"hidden\",!0),d3.selectAll(\".label-party\").transition().duration(300).style(\"opacity\",0),d3.selectAll(\".pointer-party\").transition().duration(300).style(\"opacity\",0),d3.selectAll(\"path.chosen\").classed(\"chosen\",!1).transition().duration(300).attrTween(\"transform\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2,e=\"translate(\"+Math.cos(a)*(.1*radius)+\",\"+Math.sin(a)*(.1*radius)+\")\",n=\"translate(\"+Math.cos(a)*(.05*radius)+\",\"+Math.sin(a)*(.05*radius)+\")\";return d3.interpolateString(e,n)}),d3.selectAll(\"path.active\").classed(\"hover\",!1).classed(\"active\",!1).transition().delay(300).duration(300).attrTween(\"transform\",function(t){var a=t.startAngle+(t.endAngle-t.startAngle)/2-Math.PI/2,e=\"translate(\"+Math.cos(a)*(.05*radius)+\",\"+Math.sin(a)*(.05*radius)+\")\";return d3.interpolateString(e,\"translate(0, 0)\")}),d3.selectAll(\".label-option\").transition().duration(300).style(\"opacity\",1),d3.selectAll(\".pointer-option\").transition().duration(300).style(\"opacity\",1)}).append(\"g\").attr(\"transform\",\"translate(\"+(width/2+margin.left)+\",\"+(height/2+margin.top)+\")\"),second_level_data=[];for(option in data.all)for(party in data.all[option].breakdown){var newdict=data.all[option].breakdown[party];newdict.option=option,second_level_data.push(newdict)}var option_data=[];for(i in data.all)option_data.push(data.all[i]);drawPie(second_level_data),drawOptionLabels(option_data),drawPartyLabels(second_level_data);</script>","uniquePath":"s/glasovanja-layered","__v":0,"sourceType":"template","lastUpdate":"2016-11-04T15:58:25.980Z","dateTimeCreated":"2016-05-02T18:35:57.348Z"}